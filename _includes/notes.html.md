<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>notes.html</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#my-notes">My Notes</a>
<ul>
<li><a href="#important-urls">Important URLs</a></li>
<li><a href="#productivity-tools">Productivity Tools</a></li>
<li><a href="#devops">DevOps</a></li>
<li><a href="#email">Email</a></li>
<li><a href="#nosql">NoSQL</a></li>
<li><a href="#elasticsearch">Elasticsearch</a>
<ul>
<li></li>
</ul>
</li>
<li><a href="#mongodb">MongoDB</a></li>
<li><a href="#rdbs">RDBS</a></li>
<li><a href="#unix-tools">Unix tools</a></li>
<li></li>
<li><a href="#vcs">VCS</a></li>
<li><a href="#scala">Scala</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#sftp">SFTP</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="my-notes">My Notes</h1>
<p>This is my day to day note book where I want to share. For example, it is very general to find the following information for date and time:</p>
<ul>
<li>Number of seconds per year  = <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>31536000</mn></mrow><annotation encoding="application/x-tex">31536000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">1</span><span class="mord">5</span><span class="mord">3</span><span class="mord">6</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span></span> seconds ✌️</li>
<li>Number of seconds per day (24h) = <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>86400</mn></mrow><annotation encoding="application/x-tex">86400</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span><span class="mord">6</span><span class="mord">4</span><span class="mord">0</span><span class="mord">0</span></span></span></span></span> seconds</li>
</ul>
<h2 id="important-urls">Important URLs</h2>
<p>I would like to maintain the important URLs for some apps and tools found while I am searching. For example, there the good link found from the O’REILLY Programming Newsletter  relating to the VSC which is one of my favorite:</p>
<ul>
<li>If you are terminal lover: <a href="https://conemu.github.io/">ConEmu</a> and <a href="https://www.iterm2.com/">iTerm 2</a> in Mac.</li>
</ul>
<h2 id="productivity-tools">Productivity Tools</h2>
<p>Productivity is a cross cutting concren each and very bit of work I do.</p>
<h3 id="diagraming-tools">Diagraming tools</h3>
<p>I was very enthustic to know markdown level diagraming.</p>
<p>One of the best so far found is <a href="https://mermaid-js.github.io/mermaid/#/">mermaid</a> which I cause use with the my blog tool <a href="http://stackedit.io">stackedit.io</a>. For example:</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-JQeA8Iepw4bB22OB" width="100%" style="max-width: 131.453125px;" viewBox="0 0 131.453125 171"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M36.4921875,72.5L36.4921875,97.5L61.83203125,128.89661441118142" marker-end="url(#arrowhead80)" style="fill:none"></path><defs><marker id="arrowhead80" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M119.21875,72.5L119.21875,97.5L93.87890625,128.89661441118142" marker-end="url(#arrowhead81)" style="fill:none"></path><defs><marker id="arrowhead81" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" id="X" transform="translate(36.4921875,46.25)" style="opacity: 1;"><rect rx="0" ry="0" x="-16.4921875" y="-26.25" width="32.984375" height="52.5"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-6.4921875,-16.25)"><foreignObject width="12.98828125" height="32.5"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">X</div></foreignObject></g></g></g><g class="node" id="Z" transform="translate(77.85546875,148.75)" style="opacity: 1;"><rect rx="0" ry="0" x="-16.0234375" y="-26.25" width="32.046875" height="52.5"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-6.0234375,-16.25)"><foreignObject width="12.05078125" height="32.5"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Z</div></foreignObject></g></g></g><g class="node" id="Y" transform="translate(119.21875,46.25)" style="opacity: 1;"><rect rx="0" ry="0" x="-16.234375" y="-26.25" width="32.46875" height="52.5"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-6.234375,-16.25)"><foreignObject width="12.48046875" height="32.5"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Y</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>such a great diagraming.</p>
<h2 id="devops">DevOps</h2>
<p>Here the important commands and information collected while programming.</p>
<h3 id="aws-console">AWS console</h3>
<p>configure the AWS console (For the region  <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html">http://docs.aws.amazon.com/general/latest/gr/rande.html</a>)</p>
<pre class=" language-bash"><code class="prism  language-bash">aws configure
</code></pre>
<p>Find all the running EC2 instances:</p>
<pre class=" language-bash"><code class="prism  language-bash">aws ec2 describe-instances
</code></pre>
<p>To find Instance Id</p>
<pre class=" language-bash"><code class="prism  language-bash">ec2 describe-instances <span class="token operator">|</span> <span class="token function">grep</span> InstanceId
</code></pre>
<p>Terminate the instance</p>
<pre class=" language-bash"><code class="prism  language-bash">aws ec2 terminate-instances --instance-id i-07fbd393a04fdd22c
</code></pre>
<h3 id="aws-kms">AWS KMS</h3>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment">#encrypt the password: InsightReadWrite</span>
aws kms encrypt --key-id cfc7acf7-4f20-49c3-aa11-8be4cdc3291d --output text --query CiphertextBlob --plaintext InsightReadWrite

<span class="token comment">#encrypt the password: InsightReadWrite</span>
aws kms encrypt --key-id cfc7acf7-4f20-49c3-aa11-8be4cdc3291d --plaintext fileb://test.txt --output text <span class="token operator">|</span> base64 --decode <span class="token operator">&gt;</span> out.txt

<span class="token comment">#decrypt the password: InsightReadWrite</span>
aws kms decrypt  --ciphertext-blob fileb://out.txt --output text --query Plaintext <span class="token operator">|</span> base64 --decode
</code></pre>
<h3 id="aws-kinesis">AWS Kinesis</h3>
<p>AWS Kinesis shows only example shows only one sequence. This is the record I found from the log with multiple sequences:</p>
<pre class=" language-json"><code class="prism  language-json"><span class="token punctuation">{</span>
    u <span class="token string">'Records'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        u <span class="token string">'eventVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventID'</span><span class="token punctuation">:</span> u <span class="token string">'shardId-000000000000:49559921416499955208897145459995453707469374714070171650'</span><span class="token punctuation">,</span>
        u <span class="token string">'kinesis'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            u <span class="token string">'approximateArrivalTimestamp'</span><span class="token punctuation">:</span> <span class="token number">1502065218.908</span><span class="token punctuation">,</span>
            u <span class="token string">'partitionKey'</span><span class="token punctuation">:</span> u <span class="token string">'TI2I7c'</span><span class="token punctuation">,</span>
            u <span class="token string">'data'</span><span class="token punctuation">:</span> u <span class="token string">'&lt;data1&gt;'</span><span class="token punctuation">,</span>
            u <span class="token string">'kinesisSchemaVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
            u <span class="token string">'sequenceNumber'</span><span class="token punctuation">:</span> u <span class="token string">'49559921416499955208897145459995453707469374714070171650'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        u <span class="token string">'invokeIdentityArn'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:iam::389920326251:role/Lambda-execution-role-Uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventName'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis:record'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSourceARN'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:kinesis:ap-southeast-2:389920326251:stream/ticketing-uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSource'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis'</span><span class="token punctuation">,</span>
        u <span class="token string">'awsRegion'</span><span class="token punctuation">:</span> u <span class="token string">'ap-southeast-2'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        u <span class="token string">'eventVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventID'</span><span class="token punctuation">:</span> u <span class="token string">'shardId-000000000000:49559921416499955208897145459996662633288989343244877826'</span><span class="token punctuation">,</span>
        u <span class="token string">'kinesis'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            u <span class="token string">'approximateArrivalTimestamp'</span><span class="token punctuation">:</span> <span class="token number">1502065218.908</span><span class="token punctuation">,</span>
            u <span class="token string">'partitionKey'</span><span class="token punctuation">:</span> u <span class="token string">'ihwN32'</span><span class="token punctuation">,</span>
            u <span class="token string">'data'</span><span class="token punctuation">:</span> u <span class="token string">'&lt;data2&gt;'</span><span class="token punctuation">,</span>
            u <span class="token string">'kinesisSchemaVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
            u <span class="token string">'sequenceNumber'</span><span class="token punctuation">:</span> u <span class="token string">'49559921416499955208897145459996662633288989343244877826'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        u <span class="token string">'invokeIdentityArn'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:iam::389920326251:role/Lambda-execution-role-Uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventName'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis:record'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSourceARN'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:kinesis:ap-southeast-2:389920326251:stream/ticketing-uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSource'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis'</span><span class="token punctuation">,</span>
        u <span class="token string">'awsRegion'</span><span class="token punctuation">:</span> u <span class="token string">'ap-southeast-2'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        u <span class="token string">'eventVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventID'</span><span class="token punctuation">:</span> u <span class="token string">'shardId-000000000000:49559921416499955208897145460000289410747833230768996354'</span><span class="token punctuation">,</span>
        u <span class="token string">'kinesis'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            u <span class="token string">'approximateArrivalTimestamp'</span><span class="token punctuation">:</span> <span class="token number">1502065218.913</span><span class="token punctuation">,</span>
            u <span class="token string">'partitionKey'</span><span class="token punctuation">:</span> u <span class="token string">'PoGyUG'</span><span class="token punctuation">,</span>
            u <span class="token string">'data'</span><span class="token punctuation">:</span> u <span class="token string">'H4sIAAAAAAAAAzMAACHf2/QBAAAA'</span><span class="token punctuation">,</span>
            u <span class="token string">'kinesisSchemaVersion'</span><span class="token punctuation">:</span> u <span class="token string">'1.0'</span><span class="token punctuation">,</span>
            u <span class="token string">'sequenceNumber'</span><span class="token punctuation">:</span> u <span class="token string">'&lt;data3&gt;'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        u <span class="token string">'invokeIdentityArn'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:iam::389920326251:role/Lambda-execution-role-Uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventName'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis:record'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSourceARN'</span><span class="token punctuation">:</span> u <span class="token string">'arn:aws:kinesis:ap-southeast-2:389920326251:stream/ticketing-uat'</span><span class="token punctuation">,</span>
        u <span class="token string">'eventSource'</span><span class="token punctuation">:</span> u <span class="token string">'aws:kinesis'</span><span class="token punctuation">,</span>
        u <span class="token string">'awsRegion'</span><span class="token punctuation">:</span> u <span class="token string">'ap-southeast-2'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="aws-chalice">AWS Chalice</h3>
<p>Package first :</p>
<pre class=" language-bash"><code class="prism  language-bash">aws cloudformation package --template-file out/sam.json --s3-bucket ojemr --output-template-file pkg.yaml
</code></pre>
<p>Deploy :</p>
<pre class=" language-bash"><code class="prism  language-bash">aws cloudformation deploy --template-file /home/cloudera/dev/hellochalice/pkg.yaml --stack-name hellochalice --capabilities CAPABILITY_IAM
</code></pre>
<p>SQL Server</p>
<p>Login to the docker:</p>
<pre class=" language-bash"><code class="prism  language-bash">docker <span class="token function">exec</span> -i -t 8ae7c51a90fe /bin/bash
</code></pre>
<p>Create a new folder in the /var/opt/mssql</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">cd</span> /var/opt/mssql/
<span class="token function">mkdir</span> backup
</code></pre>
<p>Download the AdventureWork from <a href="https://msftdbprodsamples.codeplex.com/downloads/get/880661">https://msftdbprodsamples.codeplex.com/downloads/get/880661</a> to your local machine and unzip.</p>
<pre class=" language-bash"><code class="prism  language-bash">docker <span class="token function">cp</span> AdventureWorks2014.bak 8ae7c51a90fe:/var/opt/mssql/backup
</code></pre>
<p>In your host machine use the sqlcmd</p>
<pre class=" language-bash"><code class="prism  language-bash">sqlcmd -S 127.0.0.1 -U SA -P <span class="token string">'&lt;password&gt;'</span>
</code></pre>
<p>Following the link <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-migrate-restore-database">https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-migrate-restore-database</a></p>
<p>Restore the backup file:</p>
<pre class=" language-bash"><code class="prism  language-bash">RESTORE DATABASE AdventureWorks
FROM DISK <span class="token operator">=</span> <span class="token string">'/var/opt/mssql/backup/AdventureWorks2014.bak'</span>
WITH MOVE <span class="token string">'AdventureWorks2014_Data'</span> TO <span class="token string">'/var/opt/mssql/data/AdventureWorks2014_Data.mdf'</span>,
MOVE <span class="token string">'AdventureWorks2014_Log'</span> TO <span class="token string">'/var/opt/mssql/data/AdventureWorks2014_Log.ldf'</span>
GO
</code></pre>
<p>How to start docker again</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment">#find the container id</span>
docker <span class="token function">ps</span> -a
<span class="token comment">#start that container id</span>
docker start <span class="token operator">&lt;</span>container-id<span class="token operator">&gt;</span>
</code></pre>
<h2 id="email">Email</h2>
<p>Most of the web application send email to their users.</p>
<h3 id="fake-the-mail-server">Fake the mail server</h3>
<p>The application is currently running in the CentOS and it uses postfix mail server as a default. For my local development, I don’t need this mail server and very happy with fake mail server which can help to find the email immediately from the console.</p>
<ul>
<li>Stop the mail server if it is running in your development</li>
<li>Create a mail service using python</li>
</ul>
<p>Here the code for the terminal:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> postfix stop
<span class="token function">sudo</span> python -m smtpd -n -c DebuggingServer localhost:25
</code></pre>
<p>Install python 2.7 on Centos:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> yum update <span class="token comment"># update yum</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> centos-release-scl <span class="token comment"># install SCL </span>
<span class="token function">sudo</span> yum <span class="token function">install</span> python27 <span class="token comment"># install Python 2.7</span>
scl <span class="token function">enable</span> python27 <span class="token function">bash</span>
</code></pre>
<p>virtual env:</p>
<pre class=" language-bash"><code class="prism  language-bash">virtualenv -p /opt/rh/python27/root/usr/bin/python <span class="token function">test</span>
<span class="token function">cd</span> <span class="token function">test</span>
<span class="token function">source</span> test/activate
</code></pre>
<h2 id="nosql">NoSQL</h2>
<p>Here are the NoSQL databases I used.</p>
<h2 id="elasticsearch">Elasticsearch</h2>
<h4 id="basic-operations">Basic Operations</h4>
<p>Add the book index:</p>
<pre class=" language-http"><code class="prism  language-http">PUT /books
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  },
  "mappings": {
    "authors" : {
      "properties": {
        "name" : {
          "type": "string"
        },
        "book_count" : {
          "type" : "integer"
        },
        "date" : {
          "type" : "date"
        }
      }
    }
  }
}
</code></pre>
<h2 id="mongodb">MongoDB</h2>
<p>How to tunnel to mongo db using ssh:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">ssh</span> -L 27017:localhost:27017 <span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span>@<span class="token operator">&lt;</span>host<span class="token operator">&gt;</span>
</code></pre>
<h3 id="queries">Queries</h3>
<p>Here the important pattern of query collection.</p>
<h4 id="basic-queries-from-mongdb-university">Basic Queries from MongDb University</h4>
<p>Array find <strong>all</strong></p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'movieDetails'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>genres<span class="token punctuation">:</span> <span class="token punctuation">{</span>$all<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Comedy'</span><span class="token punctuation">,</span> <span class="token string">'Crime'</span><span class="token punctuation">,</span> <span class="token string">'Drama'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="elemmatch">elemMatch</h4>
<pre class=" language-json"><code class="prism  language-json"><span class="token comment">/*
{
    "_id" : "Ojitha",
    "name" : "Ojitha Hewa",
    "addresses" : [ 
        {
            "street" : "321 Fake Street",
            "city" : "Epping",
            "state" : "NSW",
            "zip" : "2121"
        }, 
        {
            "street" : "5 Waterloo Rd",
            "city" : "Marsfield",
            "state" : "NSW",
            "zip" : "2120"
        }
    ]
}
*/</span>

<span class="token comment">//elemMatch example</span>
db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'embbeded'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>addresses<span class="token punctuation">:</span><span class="token punctuation">{</span>
        $elemMatch<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"state"</span><span class="token punctuation">:</span><span class="token string">"NSW"</span><span class="token punctuation">,</span><span class="token string">'zip'</span><span class="token punctuation">:</span><span class="token string">'2121'</span><span class="token punctuation">,</span> <span class="token string">"street"</span> <span class="token punctuation">:</span> <span class="token string">"321 Fake Street"</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<h4 id="aggregates">Aggregates</h4>
<p>Query to find duplicates</p>
<pre class=" language-json"><code class="prism  language-json">db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>$group <span class="token punctuation">:</span> <span class="token punctuation">{</span>
        _id <span class="token punctuation">:</span> <span class="token punctuation">{</span>un<span class="token punctuation">:</span><span class="token punctuation">{</span>userName<span class="token punctuation">:</span> <span class="token string">'$userName'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
        accountType<span class="token punctuation">:</span><span class="token punctuation">{</span>accountType<span class="token punctuation">:</span><span class="token string">'$accountType'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        count <span class="token punctuation">:</span> <span class="token punctuation">{</span>$sum <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$match<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        count <span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<h4 id="updates">Updates</h4>
<p>Here the way to insert array elements:</p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'embbeded'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"joe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$push<span class="token punctuation">:</span> 
                <span class="token punctuation">{</span>testing<span class="token punctuation">:</span> <span class="token punctuation">{</span>test1<span class="token punctuation">:</span> <span class="token string">"test1"</span><span class="token punctuation">,</span> test2<span class="token punctuation">:</span><span class="token string">"test2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//result is</span>
<span class="token comment">/*
	...
	...
    "testing" : [ 
        {
            "test1" : "test1",
            "test2" : "test2"
        }
    ]
}
*/</span>
</code></pre>
<p>Above same thing can be achieve through the</p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'embbeded'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"joe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$push<span class="token punctuation">:</span> 
                <span class="token punctuation">{</span>testing<span class="token punctuation">:</span> <span class="token punctuation">{</span>$each <span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>test1<span class="token punctuation">:</span> <span class="token string">"test1"</span><span class="token punctuation">,</span> test2<span class="token punctuation">:</span><span class="token string">"test2"</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p>Add new values without overwriting:</p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'embbeded'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"joe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$push<span class="token punctuation">:</span> 
                <span class="token punctuation">{</span>testing<span class="token punctuation">:</span> <span class="token punctuation">{</span>$each <span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>test3<span class="token punctuation">:</span> <span class="token string">"test3"</span><span class="token punctuation">,</span> test4<span class="token punctuation">:</span><span class="token string">"test4"</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span> $slice<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//result is</span>
<span class="token comment">/*
	...
	...
   ],
    "testing" : [ 
        {
            "test1" : "test1",
            "test2" : "test2"
        }, 
        {
            "test3" : "test3",
            "test4" : "test4"
        }
    ]
}
*/</span>
</code></pre>
<p>But if you want to push to the front of the array:</p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'embbeded'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"joe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$push<span class="token punctuation">:</span> 
                <span class="token punctuation">{</span>testing<span class="token punctuation">:</span> <span class="token punctuation">{</span>$each <span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>test5<span class="token punctuation">:</span> <span class="token string">"test5"</span><span class="token punctuation">,</span> test6<span class="token punctuation">:</span><span class="token string">"test6"</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span> $position<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> $slice<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//result is</span>
<span class="token comment">/*
	...
	...
   ],
    "testing" : [ 
        {
            "test5" : "test5",
            "test6" : "test6"
        }, 
        {
            "test1" : "test1",
            "test2" : "test2"
        }
    ]
}
*/</span>
</code></pre>
<p>Here the query to update the multiple documents, multi: true</p>
<pre class=" language-json"><code class="prism  language-json">db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>$and<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>userNId<span class="token punctuation">:</span> <span class="token punctuation">{</span>$exists<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>$or<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Facebook'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Google'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Twitter'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">}</span>
     <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$unset<span class="token punctuation">:</span> <span class="token punctuation">{</span>userNId<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>multi<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p>In the above query, userNId has been removed from all the documents where userNId exist and accType is Facebook, Google or Twitter.</p>
<pre class=" language-json"><code class="prism  language-json">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $and<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>userNId<span class="token punctuation">:</span> <span class="token punctuation">{</span>$exists<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>$or<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Facebook'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Google'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>accType<span class="token punctuation">:</span><span class="token string">'Twitter'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">}</span>
     <span class="token punctuation">]</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Above query shows you the changes have done in the above multi update query.</p>
<p>Mongo Replica</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">screen</span> -d -m -S mongo-rs1 mongod --port 27017 --dbpath ~/mongo/data-rs1 --replSet rs0 --smallfiles --oplogSize 128 --logpath ~/mongo/logs/mongo-rs1.log
<span class="token function">screen</span> -d -m -S mongo-rs2 mongod --port 27018 --dbpath ~/mongo/data-rs2 --replSet rs0 --smallfiles --oplogSize 128 --logpath ~/mongo/logs/mongo-rs2.log
<span class="token function">screen</span> -d -m -S mongo-rs3 mongod --port 27019 --dbpath ~/mongo/data-rs3 --replSet rs0 --smallfiles --oplogSize 128 --logpath ~/mongo/logs/mongo-rs3.log

</code></pre>
<h3 id="date-offset-for-australia">Date offset for Australia:</h3>
<p>It is important to find the proper date based on the offset in the mongo, for example consider the following dates ISODate(“2016-08-31T03:49:13.857Z”) &lt;—&gt; ISODate(“2016-08-31T13:49:13.857Z”)</p>
<pre class=" language-javascript"><code class="prism  language-javascript">#to <span class="token keyword">get</span> the AU morning
<span class="token keyword">var</span> auDate <span class="token operator">=</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">"2016-08-31T13:49:13.857Z"</span><span class="token punctuation">)</span> 
isoDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">600</span> <span class="token operator">*</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

#to <span class="token keyword">get</span> the AU date
<span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">"2016-08-31T03:49:13.857Z"</span><span class="token punctuation">)</span> 
auDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">600</span> <span class="token operator">*</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>For example, beginning of the day</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">"2016-08-31T00:00:00.000Z"</span><span class="token punctuation">)</span> 
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">600</span> <span class="token operator">*</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
# <span class="token function">ISODate</span><span class="token punctuation">(</span><span class="token string">"2016-08-30T14:00:00Z"</span><span class="token punctuation">)</span>
</code></pre>
<p>Run the following code to get the current Date and time</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'Orderlines'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"mytest"</span><span class="token punctuation">,</span>d<span class="token punctuation">:</span>date<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'Orderlines'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span><span class="token string">"mytest"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>or run</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Mongoldb oplog time stamp query</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'oplog.rs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    ts<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt <span class="token punctuation">:</span> date<span class="token punctuation">}</span><span class="token punctuation">,</span> ns<span class="token punctuation">:</span> <span class="token string">'OrdersTest.Orderlines'</span><span class="token punctuation">,</span>
    $or<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>op<span class="token punctuation">:</span><span class="token string">'i'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>op<span class="token punctuation">:</span> <span class="token string">'u'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="find-the-docs-who-has-a-field">Find the docs who has a field</h4>
<p>It is sometimes important to find the all users who has particular key</p>
<pre class=" language-json"><code class="prism  language-json">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>collection<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>target<span class="token operator">-</span>field<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>$exists<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>####Update field of array<br>
for example, Person document has addresses field and it is is an array of addresses: street is the first element. To convert all the street names to uppercase:</p>
<pre class=" language-javascript"><code class="prism  language-javascript">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>collection<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>criteria<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>addresses<span class="token punctuation">.</span>length <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>addresses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>street<span class="token operator">=</span>e<span class="token punctuation">.</span>addresses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>street<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//save to the collection</span>
    db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Update with the $pull:</p>
<pre class=" language-json"><code class="prism  language-json">db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'Orderlines'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'20161019,42121,2'</span><span class="token punctuation">,</span><span class="token string">'20161109,39661,2'</span><span class="token punctuation">,</span><span class="token string">'20161019,38036,2'</span><span class="token punctuation">,</span> <span class="token string">'583ba80a09edaa2fc0d8ba61,1'</span><span class="token punctuation">,</span> <span class="token string">'20161017,29051,9,cp'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>$pull<span class="token punctuation">:</span> <span class="token punctuation">{</span>orderlineItems<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'fees.typeName'</span><span class="token punctuation">:</span><span class="token string">'test'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>multi<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<h3 id="backup">Backup</h3>
<p>How to dump the backup and restore from the remote mong server ? Here you have to follow the three steps</p>
<ol>
<li>First create a tunnel to the remote mongo server</li>
</ol>
<pre class=" language-bash"><code class="prism  language-bash">   <span class="token function">ssh</span> -L 27018:<span class="token operator">&lt;</span>remote server<span class="token operator">&gt;</span>:27017 <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>@<span class="token operator">&lt;</span>remote server<span class="token operator">&gt;</span>
</code></pre>
<p>Here the port 27018 fro the local machine. This port is map to the :27017.</p>
<ol start="2">
<li>
<p>dump the collection to the directory</p>
<pre class=" language-bash"><code class="prism  language-bash">/usr/bin/mongodump --host localhost --port 27018  -u <span class="token operator">&lt;</span>mongodb user name<span class="token operator">&gt;</span> -p <span class="token operator">&lt;</span>mongodb password<span class="token operator">&gt;</span> -d <span class="token operator">&lt;</span>database<span class="token operator">&gt;</span> -c <span class="token operator">&lt;</span>mongo collection<span class="token operator">&gt;</span> -o <span class="token operator">&lt;</span>directory<span class="token operator">&gt;</span>	
</code></pre>
<p>as  shown in the above  you have to provide the remote mongo server username/password, datatbase and the collection.</p>
</li>
<li>
<p>Now restore the backup</p>
<pre class=" language-bash"><code class="prism  language-bash">/usr/bin/mongorestore --host 127.0.0.1 --port 27017 --db <span class="token operator">&lt;</span>database<span class="token operator">&gt;</span> --drop <span class="token operator">&lt;</span>directory<span class="token operator">&gt;</span>/user-admin
</code></pre>
<p>backup and restore is completed.</p>
</li>
</ol>
<h4 id="find-the-type-of-the-field">Find the type of the field</h4>
<p>Here the way to find the type of the field in the mongodb</p>
<pre class=" language-javascript"><code class="prism  language-javascript"> db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userName<span class="token punctuation">:</span><span class="token string">'oj_1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="rdbs">RDBS</h2>
<h3 id="h2-database">H2 Database</h3>
<p>For testing use the following to run in the watch expression:</p>
<pre class=" language-bash"><code class="prism  language-bash">org.h2.tools.Server.startWebServer<span class="token punctuation">(</span>this.jdbcTemplate.getDataSource<span class="token punctuation">(</span><span class="token punctuation">)</span>.getConnection<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre>
<p>if you need to run in the browser(start browser: <strong>java -cp h2-1.4.193.jar org.h2.tools.Console -web -browser</strong>) use the <strong>jdbc:h2:mem:dataSourc</strong>e as connection url for Spring testing.</p>
<p>##Tomcat</p>
<p>Configure the tomcat for CAS</p>
<pre class=" language-xml"><code class="prism  language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> 
	   <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.coyote.http11.Http11NioProtocol<span class="token punctuation">"</span></span> 
	   <span class="token attr-name">SSLEnabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
           <span class="token attr-name">maxThreads</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span> <span class="token attr-name">scheme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https<span class="token punctuation">"</span></span> <span class="token attr-name">secure</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
           <span class="token attr-name">clientAuth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">sslProtocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>TLS<span class="token punctuation">"</span></span>
	   <span class="token attr-name">allowTrace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> 
    	   <span class="token attr-name">keystoreFile</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>conf/abc-keys/keystore.jks<span class="token punctuation">"</span></span> 
    	   <span class="token attr-name">keystorePass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;key-password&gt;<span class="token punctuation">"</span></span> 
    	   <span class="token attr-name">truststoreFile</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>conf/abc-keys/truststore.jks<span class="token punctuation">"</span></span>
    	   <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">useBodyEncodingForURI</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
<p>Add the above code to the server.xml file before the <code>&lt;Connector port="8009" protocol...</code> statement.</p>
<p>Install apahce web server</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> httpd -y
</code></pre>
<p>Start the service</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> <span class="token function">service</span> httpd start
</code></pre>
<p>Configure to start every time:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> <span class="token function">chkconfig</span> httpd on
</code></pre>
<p>Show the disk volumes</p>
<pre class=" language-bash"><code class="prism  language-bash">lsblk
</code></pre>
<p>check the data in the volume:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> <span class="token function">file</span> -s /dev/xvdf
</code></pre>
<p>format the before mount the volume:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> mkfs -t ext4 /dev/xvdf
</code></pre>
<p>Now mount the volume:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment">#first create myfileserver</span>
<span class="token function">cd</span> /
<span class="token function">sudo</span> <span class="token function">mkdir</span> myfileserver

<span class="token comment">#then mount</span>
<span class="token function">sudo</span> <span class="token function">mount</span> /dev/xvdf /myfileserver
</code></pre>
<p>Unmount as a root:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">umount</span> /dev/xvdf
</code></pre>
<h2 id="unix-tools">Unix tools</h2>
<p>change the shell to zsh</p>
<pre class=" language-bash"><code class="prism  language-bash">chsh -s /bin/zsh
</code></pre>
<p>Edit a file in a TextEdit</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">open</span> -a TextEdit ~/.zshrc
</code></pre>
<p>Find the file names only with the text recusively</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -il -r --include <span class="token string">"*.py"</span> <span class="token string">'text'</span> <span class="token keyword">.</span>
</code></pre>
<p>Find all the files with wild card recursively:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">find</span> <span class="token keyword">.</span> -name <span class="token string">"*.pyc"</span> -exec <span class="token function">ls</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> \<span class="token punctuation">;</span>
</code></pre>
<p>Another recursive example with include and exclude directory:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -rI --include<span class="token operator">=</span><span class="token string">'*.py'</span>  --exclude-dir<span class="token operator">=</span><span class="token string">'lib'</span> <span class="token string">"S3Service"</span> *
</code></pre>
<p>To show all the CHAPTERS:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -i chapter novel.txt
</code></pre>
<p>Cut only the chapter headings</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -i chapter novel.txt <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">' '</span> -f3-
</code></pre>
<p>Read the line where CHAPTER contains but start with ‘the’ in the novel.txt.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -E <span class="token string">'^CHAPTER (.*)\. The'</span> novel.txt
</code></pre>
<p>Every word more 5 or more characters</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">grep</span> -oE <span class="token string">'\w{5,}'</span> novel.txt
</code></pre>
<p>In the redhat to start the firewall GUI, type the following command:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> system-config-firewall
</code></pre>
<p>Here the way to validate xml file for schema and generate the report</p>
<pre class=" language-bash"><code class="prism  language-bash">	xmllint  --noout --valid --schema UserCentralClients.xsd sample2.xml <span class="token operator">&gt;</span> error.txt 2<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1
</code></pre>
<p>noout will stop xml written to the error.txt.</p>
<h3 id="awk">awk</h3>
<p>Commandline</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">awk</span> -F, <span class="token string">'{<span class="token variable">$2</span>="***"; print <span class="token variable">$1</span> <span class="token variable">$2</span>}'</span>  test.txt
</code></pre>
<p>Above logic in the file called f:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">awk</span> -F, -f t test.txt 
</code></pre>
<p>Both the above commands produce the same.</p>
<p>here the contents of the f file:</p>
<pre class=" language-bash"><code class="prism  language-bash">BEGIN <span class="token punctuation">{</span>
  print <span class="token string">"1 st \t 2nd"</span>
  print <span class="token string">"==== \t ==="</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token variable">$2</span><span class="token operator">=</span><span class="token string">"***"</span><span class="token punctuation">;</span>
  print <span class="token variable">$1</span> <span class="token string">"\t"</span> <span class="token variable">$2</span>
<span class="token punctuation">}</span>

END<span class="token punctuation">{</span>
  print <span class="token string">"the end"</span>
<span class="token punctuation">}</span>

</code></pre>
<h2 id="section"></h2>
<h3 id="brew">Brew</h3>
<p>List installed packages</p>
<pre class=" language-bash"><code class="prism  language-bash">brew list -1
</code></pre>
<h3 id="terminal-commands">Terminal Commands</h3>
<p>Find the type of the command</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">type</span> -a <span class="token function">pwd</span>
</code></pre>
<p>create tar file</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">tar</span> -czvf mylogs.tar.gz logs-*.log
</code></pre>
<p>find the directory in the Unix</p>
<pre class=" language-shell"><code class="prism  language-shell">find / -type d -name 'pyve*' 2&gt;&amp;1 | grep -v "Permission denied"
#or
find . -type d -name 'pyve*'  2&gt;/dev/null
</code></pre>
<p>filter the file lines:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sed</span> -n <span class="token string">'1 , 3 p'</span> my.txt <span class="token operator">&gt;</span> test.txt
</code></pre>
<p>Top occurrence words in a page</p>
<pre class=" language-bash"><code class="prism  language-bash">curl -s http://www.gutenberg.org/files/4300/4300-0.txt <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span> <span class="token operator">|</span> <span class="token function">grep</span> -oE <span class="token string">'\w+'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c <span class="token operator">|</span> <span class="token function">sort</span> -nr <span class="token operator">|</span> <span class="token function">head</span> -n 10
</code></pre>
<p>Use of Python as command line tool</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token keyword">from</span> sys <span class="token keyword">import</span> stdin<span class="token punctuation">,</span> stdout
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> stdin<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> line<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"%d\n"</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Above will display the lines generated from the sequence.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment">#permission</span>
<span class="token function">chmod</span> u+x stream.py

<span class="token comment">#create the pipeline</span>
<span class="token function">seq</span> 1000 <span class="token operator">|</span> ./stream.py
</code></pre>
<p>Substitute seq</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">seq</span> -f <span class="token string">"Line %g"</span> 10
</code></pre>
<p>Here the equlents, lines is a file</p>
<pre><code>&lt; lines head -n 3
&lt; lines sed -n 1,3p
&lt; lines awk 'NR&lt;=3'
</code></pre>
<h3 id="disk-management">Disk Management</h3>
<p>To display size of the folder</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">du</span> -hsx *
</code></pre>
<p>this will display the usage of the directory.<br>
The following code show the top 20 files which used most of the file space</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">du</span> -a <span class="token operator">|</span> <span class="token function">sort</span> -n -r <span class="token operator">|</span> <span class="token function">head</span> -n 20
</code></pre>
<p>This will show directory wise usage of file space</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">du</span> -hsx * <span class="token operator">|</span> <span class="token function">sort</span> -n -r <span class="token operator">|</span> <span class="token function">head</span> -n 20
</code></pre>
<p>Here</p>
<blockquote>
<ul>
<li>du command -h option : display sizes in human readable format.</li>
<li>du command -s option : show only a total for each argument (summary).</li>
<li>du command -x option : skip directories on different file systems.</li>
</ul>
</blockquote>
<h2 id="vcs">VCS</h2>
<p>Git is the main version control system I am using currently.</p>
<h3 id="git">Git</h3>
<p>Configuration commands are:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> config --global user.name
<span class="token function">git</span> config --global user.email
<span class="token function">git</span> config --global --list
</code></pre>
<p>Here the log to show all the branches</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> log --oneline --all --graph --decorate
</code></pre>
<p>configure alias global level</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> config --global alias.lg <span class="token string">"log --oneline --all --graph --decorate"</span>
</code></pre>
<p>To see the commit history</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> reflog
</code></pre>
<p>Set the push limited only to the current branch:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> config --global push.default simple
</code></pre>
<p>List all the master branches:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> branch -a
</code></pre>
<p>Rename a file:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> <span class="token function">mv</span> index.html home.htm
</code></pre>
<p>Delete the file:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> <span class="token function">rm</span> index.html
</code></pre>
<p>Push only the tags:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> push --tags
</code></pre>
<p>Fetch without merging:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment"># currently in the master branch</span>
<span class="token function">git</span> fetch
<span class="token function">git</span> checkout orign/master
<span class="token function">cat</span> test.com
<span class="token function">git</span> checkout master
<span class="token function">git</span> merge origin/master
</code></pre>
<p>rebasing</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> pull --rebase
</code></pre>
<p>After commit and push if need to revert back due to the mistakes, follow the following command with SHA1</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> revert <span class="token operator">&lt;</span>SHA1<span class="token operator">&gt;</span>
</code></pre>
<p>However, with the git lg above will show the history of the revert and the mistake.</p>
<p>To get rid of the last two commits:</p>
<ul>
<li>completely throw away including files: <code>hard</code></li>
<li>files back to the staging area from commit: <code>soft</code></li>
<li>default will blow away the commits, remove the files from the staging area but leave the files: <code>mixed</code></li>
</ul>
<pre class=" language-shell"><code class="prism  language-shell">git reset HEAD~2
</code></pre>
<p>if you need to get back the <code>git reset --hard HEAD~2</code> back use the SHA as follows</p>
<pre class=" language-shell"><code class="prism  language-shell">git reset --hard &lt;SHA&gt;
</code></pre>
<p>How to insert multiple commits:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment"># add new file</span>
<span class="token function">touch</span> test.html
<span class="token function">git</span> add <span class="token keyword">.</span>
<span class="token function">git</span> commit -m <span class="token string">"Add the test html file"</span>
</code></pre>
<p>Now one way to insert SHA from another branch is cherry-pick as explained. The second way is (check the commit history if there is no new branch but recovering pervious commit and select that SHA)</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment"># based on your SHA</span>
<span class="token comment"># then create a new branch from that</span>
<span class="token function">git</span> checkout SHA

<span class="token comment">#from the above checkout branch create a tmp branch</span>
<span class="token function">git</span> checkout -b tmp

<span class="token comment">#now you can check with the "git lg", you will see new branch</span>
<span class="token comment">#now rebase against master</span>
<span class="token function">git</span> rebase master
</code></pre>
<p>Interactive rebase last 5 commits:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> rebase -i HEAD~5
</code></pre>
<p>find the commit from log message:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> log --all --grep<span class="token operator">=</span><span class="token string">'prepare release 1.0.12'</span> 
</code></pre>
<p>find all the branches where commit is available:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> branch -r --contains 833187d69f6a776b715ddb5c0a1806d06e8159cb
<span class="token comment">#if need to checkout the commit</span>
<span class="token function">git</span> checkout 833187d69f6a776b715ddb5c0a1806d06e8159cb
</code></pre>
<h4 id="alias">Alias</h4>
<p>(alias#git_alias)<br>
Some important alias to <strong>~/.gitconfig</strong> :</p>
<pre class=" language-git"><code class="prism  language-git">[alias]
	  show-last-commit = !sh -c <span class="token string">'git log $1@{1}..$1@{0} "$@"'</span>
	  del-tag = !sh -c <span class="token string">'git tag -d $1 &amp;&amp; git push origin :$1'</span> -
	  del-branch = !sh -c <span class="token string">'git branch -d $1 &amp;&amp; git push origin :$1'</span> -
	  pt = !sh -c <span class="token string">'git tag $1 &amp;&amp; git push origin $1'</span> -	
</code></pre>
<p>the <code>git new</code> command shows the latest commit. I used this to find the change id for gerrit specially. The commands <code>git dt &lt;tag name&gt;</code> and <code>git db &lt;branch name&gt;</code> respectively delete the tag and the branch. if need to tag and push that tag with one command use: <code>git pt &lt;tag name&gt;</code>.</p>
<p><strong>Grog</strong></p>
<p>to show the log</p>
<pre class=" language-git"><code class="prism  language-git">git config --global alias.grog <span class="token string">'log --graph --abbrev-commit --decorate --all --format=format:"%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(dim white) - %an%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n %C(white)%s%C(reset)"'</span>
</code></pre>
<p><strong>Shorty</strong></p>
<p>Show the short status</p>
<pre class=" language-shell"><code class="prism  language-shell">git config --global alias.shorty 'status --short --branch'
</code></pre>
<p><strong>Amend</strong></p>
<p>Amend the forget files after add</p>
<pre class=" language-git"><code class="prism  language-git">git config --global alias.commend <span class="token string">'commit --amend --no-edit'</span>
</code></pre>
<p>Here the short cut review command for the Gerrit:</p>
<pre class=" language-git"><code class="prism  language-git">	  review = !sh -c <span class="token string">'git push origin HEAD:refs/for/develop%topic=$1,r=Easthope.Michael'</span> -
</code></pre>
<h4 id="store-password">Store password</h4>
<p>Store Gerrit password in local workspace</p>
<p>Instead of type password each time when you push or pull from the gerrit, you can store the password permanently:</p>
<pre class=" language-git"><code class="prism  language-git">git config credential.helper store
</code></pre>
<p>Then issue the command and provide the password first time. Then after git will never ask the password until you unset as follows</p>
<pre class=" language-git"><code class="prism  language-git">git config --unset credential.helper
</code></pre>
<p>Only once you have to do this.</p>
<h4 id="abort-merge">Abort merge</h4>
<p>In the new git,</p>
<pre class=" language-git"><code class="prism  language-git">	git merge --abort
</code></pre>
<h4 id="cherry-pick">cherry pick</h4>
<p>Apply one commit to another branch. Say you have a commit in the <em>WORK</em> branch and you need to bring this commit to the <em>DEVE</em> branch. First move to the <em>DEVE</em> branch. Then see the tree;</p>
<pre class=" language-git"><code class="prism  language-git">	git checkout DEVE
	git log -n10 --oneline --graph WORK
	* 95d21d6 Changed the driver.
	*   a238007 release-1.42.0 - Resolved
	*  ... 
</code></pre>
<p>Then select the commit hash from the tree graph. Say commit hash is <em>95d21d6</em></p>
<pre class=" language-git"><code class="prism  language-git">	git cherry-pick 95d21d6
</code></pre>
<p>Now check the cherry pick has been applied ?</p>
<pre class=" language-git"><code class="prism  language-git">	git log -n10 --oneline --graph DEVE
	* 5e7ee1a Changed the driver.
	*   9607ea0 Merge branch 'DEVE...
	* ...
</code></pre>
<p>Although commit has changed, from the comment you can find that changes are applied. For example, change commit 9607ea0 is the commit before the cherry pick. To diff</p>
<pre class=" language-git"><code class="prism  language-git">	git diff 9607ea0..HEAD
		...
		...
	git diff 9607ea0..HEAD --name-only
		...
		...
</code></pre>
<p>if you need to find the detail of the branch differences</p>
<pre class=" language-git"><code class="prism  language-git">git log --graph --pretty=format:<span class="token string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr)%Creset'</span> --abbrev-commit --date=relative develop..release-1.42.3-develop
</code></pre>
<p>If you need to revert the cherry-pick due to the merge confilicts</p>
<pre class=" language-git"><code class="prism  language-git">git reset --merge
</code></pre>
<h4 id="important">Important</h4>
<p>Here the important information such as references and tutorials.</p>

<table>
<thead>
<tr>
<th>topic</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Merge and Rebase</td>
<td><a href="https://www.atlassian.com/git/tutorials/merging-vs-rebasing">https://www.atlassian.com/git/tutorials/merging-vs-rebasing</a></td>
</tr>
</tbody>
</table><h3 id="gerrit">Gerrit</h3>
<h4 id="setup">Setup</h4>
<p>Before commit for the review, Gerrit need to be enable for review. The change-id has to be attached with each and every commit.  Two steps to follow</p>
<ul>
<li>Make the hook</li>
</ul>
<pre class=" language-bash"><code class="prism  language-bash">curl -Lo ABCID/.git/hooks/commit-msg http://<span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>@<span class="token operator">&lt;</span>gerrit server<span class="token operator">&gt;</span>/gerrit/tools/hooks/commit-msg
</code></pre>
<ul>
<li>make the hook executable</li>
</ul>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">chmod</span> +x .git/hooks/commit-msg
</code></pre>
<p>Now you are ready to do the first commit in the Gerrit.</p>
<h4 id="review">Review</h4>
<p>Gerrit is based on Git server, but support more features such as review because there is embedded workflow in the Gerrit.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> push origin HEAD:refs/for/<span class="token operator">&lt;</span>target branch<span class="token operator">&gt;</span>%topic<span class="token operator">=</span><span class="token operator">&lt;</span>topic to show <span class="token keyword">in</span> the dashboard<span class="token operator">&gt;</span>,r<span class="token operator">=</span><span class="token operator">&lt;</span>reviewer<span class="token operator">&gt;</span>
</code></pre>
<p>is the review command to run in Git prompt.</p>
<p>##Groovy<br>
###XML<br>
XML processing in the groovy, you need to read xml file to the variable in the groovy shell:</p>
<pre class=" language-groovy"><code class="prism  language-groovy">	<span class="token keyword">import</span> groovy<span class="token operator">.</span>xml<span class="token operator">.</span><span class="token operator">*</span>
	clients <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">parseText</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'sampl.xml'</span><span class="token punctuation">)</span><span class="token operator">.</span>text<span class="token punctuation">)</span>
	
	<span class="token comment">//define namespace</span>
	ns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Namespace</span><span class="token punctuation">(</span><span class="token string">'http://www.my.net.au/uc/bulkexport/clientxml'</span><span class="token punctuation">)</span>
</code></pre>
<p>Say you need to display the Status of the first Clients/Client</p>
<pre class=" language-groovy"><code class="prism  language-groovy"><span class="token comment">//	&lt;Clients xmlns:'http://www.my.net.au/uc/bulkexport/clientxml'...&gt;</span>
<span class="token comment">// 		&lt;Client&gt;</span>
<span class="token comment">//			&lt;Status&gt;Y&lt;/Status&gt;</span>
<span class="token comment">//		&lt;/Client&gt;</span>
<span class="token comment">//		...</span>
<span class="token comment">//		...</span>
<span class="token comment">//	&lt;/Clients&gt;</span>

println clients<span class="token operator">.</span>Client<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ns<span class="token operator">.</span>Status<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
<p>Your output will be ‘Y’.</p>
<pre class=" language-groovy"><code class="prism  language-groovy"><span class="token comment">//	for all the clients</span>
clients<span class="token operator">.</span>Client<span class="token operator">.</span>each <span class="token punctuation">{</span> println it<span class="token punctuation">[</span>ns<span class="token operator">.</span>Status<span class="token punctuation">]</span><span class="token operator">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre>
<h3 id="ldap">LDAP</h3>
<p>Here the program to test the ldap in groovy. File name is hello.groovy:</p>
<pre class=" language-groovy"><code class="prism  language-groovy"><span class="token keyword">import</span> org<span class="token operator">.</span>apache<span class="token operator">.</span>directory<span class="token operator">.</span>groovyldap<span class="token operator">.</span>LDAP
<span class="token keyword">import</span> org<span class="token operator">.</span>apache<span class="token operator">.</span>directory<span class="token operator">.</span>groovyldap<span class="token operator">.</span>SearchScope

LDAP con <span class="token operator">=</span> LDAP<span class="token operator">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">'ldap://10.25.192.242:389'</span><span class="token punctuation">,</span><span class="token string">'cn=ojitha,OU=oj Users,DC=aus'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>con<span class="token operator">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'cn=ojitha,OU=oj Users,DC=aus'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string gstring">" Not exists!"</span>
</code></pre>
<p>run as: <code>groovy -cp ~/applications/groovyldap/dist/groovy-ldap.jar hello.groovy</code><br>
The thridparty lib available at <a href="https://directory.apache.org/api/groovy-api/1-groovy-ldap-download.html">https://directory.apache.org/api/groovy-api/1-groovy-ldap-download.html</a>.</p>
<h2 id="scala">Scala</h2>
<h3 id="xml">XML</h3>
<p>Read the xml file and write to the text file in Scala</p>
<pre class=" language-scala"><code class="prism  language-scala"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token punctuation">{</span>File<span class="token punctuation">,</span> PrintWriter<span class="token punctuation">}</span>
<span class="token keyword">import</span> scala<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>XML

<span class="token keyword">val</span> xml <span class="token operator">=</span> XML<span class="token punctuation">.</span>loadFile<span class="token punctuation">(</span><span class="token string">"/home/ojitha.../sampl.xml"</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> clients <span class="token operator">=</span> xml \\ <span class="token string">"Clients"</span> \ <span class="token string">"Client"</span>
<span class="token keyword">val</span> file <span class="token operator">=</span> <span class="token keyword">new</span> PrintWriter<span class="token punctuation">(</span><span class="token keyword">new</span> File<span class="token punctuation">(</span><span class="token string">"test/id.text"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
clients<span class="token punctuation">.</span>foreach<span class="token punctuation">{</span> n <span class="token keyword">=&gt;</span>
  <span class="token keyword">val</span> client <span class="token operator">=</span> n \ <span class="token string">"ClientIdentifier"</span>
  file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>client<span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token string">", "</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
file<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>the id.text will be available at the <code>~/text</code> folder.</p>
<h2 id="python">Python</h2>
<p>Install Virtual environment for Python 3:</p>
<pre class=" language-bash"><code class="prism  language-bash">python3.5 -m venv t1
<span class="token function">cd</span> t1
<span class="token function">source</span> bin/activate
</code></pre>
<h3 id="pyenv-environment">Pyenv environment</h3>
<p>List the virtual environments:</p>
<pre class=" language-bash"><code class="prism  language-bash">pyenv virtualenvs
</code></pre>
<p>To activate environment</p>
<pre class=" language-bash"><code class="prism  language-bash">pyenv activate <span class="token operator">&lt;</span>env<span class="token operator">&gt;</span>
</code></pre>
<p>To deactivate</p>
<pre class=" language-bash"><code class="prism  language-bash">pyenv deactivate
</code></pre>
<p>To delete</p>
<pre class=" language-bash"><code class="prism  language-bash">pyenv uninstall <span class="token operator">&lt;</span>environment<span class="token operator">&gt;</span>
</code></pre>
<p>To create new</p>
<pre class=" language-bash"><code class="prism  language-bash">pyenv virtualenv <span class="token operator">&lt;</span>env<span class="token operator">&gt;</span>
</code></pre>
<h2 id="sftp">SFTP</h2>
<p>To connect to the SFTF site:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sftp</span> -o IdentityFile<span class="token operator">=</span>live-lessons.pem sftpuser@ec2-54-252-168-81.ap-southeast-2.compute.amazonaws.com
</code></pre>
<p>Install AWS Chalice</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> yum groupinstall -y <span class="token string">"development tools"</span>
</code></pre>
<p>next</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel expat-devel
</code></pre>
<p>download and install python 2.7.13</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">wget</span> http://python.org/ftp/python/2.7.13/Python-2.7.13.tar.xz
<span class="token function">tar</span> xf Python-2.7.13.tar.xz
<span class="token function">cd</span> Python-2.7.13
./configure --prefix<span class="token operator">=</span>/usr/local --enable-unicode<span class="token operator">=</span>ucs4 --enable-shared LDFLAGS<span class="token operator">=</span><span class="token string">"-Wl,-rpath /usr/local/lib"</span>
<span class="token function">make</span> 
<span class="token function">sudo</span> <span class="token function">make</span> altinstall
</code></pre>
<p>to optimize</p>
<pre class=" language-bash"><code class="prism  language-bash">strip /usr/local/lib/libpython2.7.so.1.0
</code></pre>
<p>create links</p>
<pre class=" language-shell"><code class="prism  language-shell">sudo ln -sf /usr/local/bin/python2.7 /usr/bin/python2.7
</code></pre>
<p>download pip:</p>
<pre class=" language-bash"><code class="prism  language-bash">curl -O https://svn.apache.org/repos/asf/oodt/tools/oodtsite.publisher/trunk/distribute_setup.py
</code></pre>
<p>install pip</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> python2.7 distribute_setup.py
<span class="token function">sudo</span> easy_install pip
</code></pre>
<p>Install virtual environment</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">sudo</span> pip2.7 <span class="token function">install</span> virtualenv
</code></pre>
<p>Install Chalice</p>
<pre class=" language-shell"><code class="prism  language-shell">virtualenv ~/.virtualenvs/chalice
</code></pre>
<p>activate the environment each and every time when new terminal open</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">source</span> ~/.virtualenvs/chalice/bin/activate
</code></pre>
<p>but only once install the AWS Chalice</p>
<pre class=" language-bash"><code class="prism  language-bash">pip <span class="token function">install</span> chalice
</code></pre>
<p>Now create the project you want</p>
<pre class=" language-bash"><code class="prism  language-bash">chalice new-project <span class="token operator">&lt;</span>project name<span class="token operator">&gt;</span>
</code></pre>
<p>Install paramiko</p>
<pre class=" language-bash"><code class="prism  language-bash">pip <span class="token function">install</span> paramiko
</code></pre>
<p>following libs are installed</p>
<p>asn1crypto-0.22.0 cffi-1.10.0 cryptography-1.8.1 enum34-1.1.6 idna-2.5 ipaddress-1.0.18 paramiko-2.1.2 pyasn1-0.2.3 pycparser-2.17</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

    </div>
  </div>
</body>

</html>
